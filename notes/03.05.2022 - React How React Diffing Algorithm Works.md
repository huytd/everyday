# 03.05.2022 - React/How React Diffing Algorithm Works

If you are busy, here is what you are looking for:

**React Reconciliation** is the tree diffing algorithm that React used to update your application's DOM tree between renders. The [existing algorithms](https://grfia.dlsi.ua.es/ml/algorithms/references/editsurvey_bille.pdf) do this in **O(n^3)** time, with **n** is the number of nodes in the tree, which is not great.

React implements an **O(n)** time diffing algorithm based on some assumptions:

- Two elements of different types will produce different trees
- The developer can use the `key` prop to hint that an element is stable between trees

---

Every time a component updates (on state or prop changes, insert or delete a children node,...), the `render()` function will be called, the output is a **render tree** containing all the DOM elements created by your component and its children.

If React just replace one render tree with another on every render, it would be extremely slow, so it needs to have some sort of diffing algorithm to compare and generate the minimum number of operations to transform one render tree to another.

The way the algorithm works is:

- If two elements are the same type, React will check each of the attributes and only update what changed. The algorithm continues with all the current component's children.
- If two elements have different types, all old DOM nodes are destroyed, new DOM nodes are inserted, all the lifecycle methods of the component and its children like `componentWillUnmount()`, `componentDidMount()`,... will be called.

The reconciliation algorithm cannot tell the difference between the two render trees if the child elements are just re-ordered, in this case, we could use a `key` prop to give it a hint.

It's important to note that, the current algorithm will not try to match two subtrees if they are of different component types.

Keys need to be unique in the same subtree and should be stable and predictable, for example, don't use random ID, and be cautious if you use array index for the key.

**Reference:** https://reactjs.org/docs/reconciliation.html
